{% extends "base.html" %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-12">
                    <h5 class="text text-primary">Monthly Report</h5>
                </div>
            </div>
            <form id="dataForm">
                {% csrf_token %}
                <div class="row align-items-end">
                    <div class="col-md-2">
                        <label for="selected_year" class="form-label">Select year:</label>
                        <select class='form-select form-select-sm' id="selected_year" name='selected_year'>
                            {% for y in year_array %}
                                <option value="{{ y }}">{{ y }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="selected_type" class="form-label">Select type:</label>
                        <select class='form-select form-select-sm' id="selected_type" name='selected_type'>
                            <option value="Expenses">Expenses</option>
                            <option value="Income">Income</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="selected_group" class="form-label">Select group:</label>
                        <select class='form-select form-select-sm' id="selected_group" name='selected_group'>
                            <option value="category">Category</option>
                            <!-- <option value="payee">Payee/Recipient</option> -->
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Select tier:</label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="tier1" name="tier" value="1" onclick="expenses_tier('1')">
                                <label class="form-check-label" for="tier1">: Tier 1</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="tier2" name="tier" value="2" onclick="expenses_tier('2')">
                                <label class="form-check-label" for="tier2">: Tier 2</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="tier3" name="tier" value="3" onclick="expenses_tier('3')">
                                <label class="form-check-label" for="tier3">: Tier 3</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="tier4" name="tier" value="4" onclick="expenses_tier('4')">
                                <label class="form-check-label" for="tier4">: Tier 4</label>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .popup {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1000;
    }

    .popup-content {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto;
        font-size: 11px; /* Smaller font size */
        padding-top: 30px; /* Add some top padding to make room for the search box */
    }

    .popup-content h3 {
        position: absolute;
        font-size: 16px; /* Smaller font for the title */
        margin-bottom: 10px;
    }

    .popup-content .esc-hint {
        font-size: 11px;
        color: #666;
        text-align: center;
        margin-top: 10px;
    }

    .popup-table {
        width: 100%;
        border-collapse: collapse;
    }

    .popup-table th, .popup-table td {
        border: 1px solid #ddd;
        padding: 4px 6px;
        text-align: left;
    }

    .popup-table th {
        background-color: #f2f2f2;
        font-size: 12x;
    }

    .popup-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .popup-table .amount-cell {
        text-align: right;
        font-family: monospace; /* For better alignment of numbers */
    }

    #popupSearch {
        padding: 5px;
        margin-bottom: 10px;
        width: 200px;
        float: right;
    }


    /* ... (rest of the styles remain the same) ... */
</style>

<div class="content mt-2">
    <h5 id='header' class='text-primary mb-3'></h5>
    <div class="container-fluid">
        <div class="content mt-2">    
            <div class="container">
              <div class="reportcontents">
                {{ rep_contents|safe }}
              </div>
            </div>
        </div>        
    </div>
</div>

<script>
function expenses_tier(selected_tier) {
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    const year = document.getElementById('selected_year').value;
    const type = document.getElementById('selected_type').value;
    const group = document.getElementById('selected_group').value;
    const tier = selected_tier;
    //const tier = document.querySelector('input[name="tier"]:checked').value;

    console.log(type);
    console.log("Selected tier:", tier);
    console.log(year);
    console.log(group);

    const requestData = {
        // Add any parameters you need for fetching data
        tier : tier,
        type : type,
        group : group,
        year : year,
    };

    fetch('../home/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify(requestData),
    })

    .then(response => response.json())
    .then(received_data => {
        document.querySelector('.reportcontents').innerHTML = received_data.rep_contents;
      })
    .catch(error => {
        console.error('Error fetching data:', error);
    })
}

function createHeader(combined_header) {
    document.getElementById('header').innerHTML = '&nbsp&nbsp&nbsp&nbsp '
        + combined_header ;
}

document.addEventListener('DOMContentLoaded', function() {
    // Your existing initialization code...

    // Add event listener for ESC key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closePopup();
        }
    });
});

</script>
{% endblock %}